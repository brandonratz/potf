!function e(t,n,r){function a(i,s){if(!n[i]){if(!t[i]){var l="function"==typeof require&&require;if(!s&&l)return l(i,!0);if(o)return o(i,!0);throw new Error("Cannot find module '"+i+"'")}var c=n[i]={exports:{}};t[i][0].call(c.exports,function(e){var n=t[i][1][e];return a(n?n:e)},c,c.exports,e,t,n,r)}return n[i].exports}for(var o="function"==typeof require&&require,i=0;i<r.length;i++)a(r[i]);return a}({1:[function(){!function(){angular.module("myApp",["ngRoute"]).config(["$routeProvider",function(e){e.when("/",{templateUrl:"partials/home.html",controller:"HomeCtrl",controllerAs:"home"}).when("/error",{templateUrl:"partials/error.html",controller:"ErrorCtrl",controllerAs:"error"}).when("/lots/:_id/:start/:end",{templateUrl:"partials/lot.html",controller:"LotCtrl",controllerAs:"lot"}).when("/reservations",{templateUrl:"partials/reservations.html",controller:"ReservationsCtrl",controllerAs:"reservations"}).otherwise({redirectTo:"/"})}])}(),function(){angular.module("myApp").controller("ErrorCtrl",["$window",function(e){this.reloadApplication=function(){e.location.href="/"}}])}(),function(){angular.module("myApp").controller("HomeCtrl",["$timeout","$window","homeState","navigator","search",function(e,t,n,r,a){function o(){for(var e=0;e<c.length;e++)t.google.maps.event.clearInstanceListeners(c[e]),c[e].setMap(null)}function i(){o(),t.google.maps.event.clearInstanceListeners(n.map),t.document.getElementById("map-container").style.visibility="hidden"}function s(){o();var s=n.map.getBounds().getNorthEast(),l=n.map.getBounds().getSouthWest(),u=a.getDistanceFromLatLonInKm(s.lat(),s.lng(),l.lat(),l.lng());a.search({lat:n.map.getCenter().lat(),lng:n.map.getCenter().lng(),dia:u,start:n.searchWindow.start.getTime(),end:n.searchWindow.end.getTime()}).then(function(a){for(var o=0;o<a.length;o++)!function(a){var o="assets/img/available.png";0===a.available&&(o="assets/img/unavailable.png");var s=new t.google.maps.Marker({position:{lat:a.lat,lng:a.lng},map:n.map,icon:o});0!==a.available&&t.google.maps.event.addListener(s,"click",function(){i(),e(function(){r.navigate("/lots/"+a._id+"/"+n.searchWindow.start.getTime()+"/"+n.searchWindow.end.getTime())})}),c.push(s)}(a[o])}).catch(function(){i(),r.navigate("/error")})}var l=this;l.menuOpen=!1,l.timeOpen=!1,l.searchDateInput=new Date(n.searchWindow.start.getFullYear(),n.searchWindow.start.getMonth(),n.searchWindow.start.getDate()),l.searchHoursInput=n.searchWindow.start.getHours();var c=[];l.navigateReservations=function(){i(),r.navigate("/reservations")},l.searchUpdate=function(){l.timeOpen=!1,n.searchWindow.start=new Date(l.searchDateInput.getTime()+60*l.searchHoursInput*60*1e3),n.searchWindow.end=new Date(n.searchWindow.start.getTime()+864e5),s()},t.google.maps.event.addListener(n.map,"idle",function(){n.mapReady=!0,s()}),t.document.getElementById("map-container").style.visibility="visible",n.mapReady&&s()}])}(),function(){angular.module("myApp").controller("LotCtrl",["$routeParams","Lots","navigator","Reservations",function(e,t,n,r){function a(){r.query({lot:e._id,active:"true"}).then(function(e){o.reservations=e}).catch(function(){n.navigate("/error")})}var o=this;o.reserved=!1,o.full=!1,o.reservations=[],o.navigate=n.navigate,o.start=e.start,o.end=e.end,t.get({_id:e._id}).then(function(e){o.lot=e}).catch(function(){n.navigate("/error")}),o.reserve=function(){var t=new r({lot:e._id,start:o.start,end:o.end});t.$save().then(function(){o.reserved=!0,a()}).catch(function(){o.full=!0,a()})},a()}])}(),function(){angular.module("myApp").controller("ReservationsCtrl",["navigator","Reservations",function(e,t){var n=this;n.all=!1,n.navigate=e.navigate,n.reservations=[];var r=new Date;n.now=r.getTime(),t.query({active:"true"}).then(function(e){n.reservations=e}).catch(function(){e.navigate("/error")}),n.showAll=function(){console.log("test show"),n.all=!0,t.query().then(function(e){n.reservations=e}).catch(function(){e.navigate("/error")})},n.cancel=function(e){console.log("test cenale"),delete n.reservations[e]}}])}(),function(){angular.module("myApp").factory("homeState",["$window",function(e){var t={mapReady:!1,searchWindow:{}},n=new Date;t.searchWindow.start=new Date(n.getFullYear(),n.getMonth(),n.getDate(),n.getHours()),t.searchWindow.end=new Date(t.searchWindow.start.getTime()+864e5);var r={center:{lat:29.6316144,lng:-82.3595472},zoom:13,disableDefaultUI:!0,zoomControl:!0,zoomControlOptions:{style:e.google.maps.ZoomControlStyle.DEFAULT,position:e.google.maps.ControlPosition.BOTTOM_LEFT},scaleControl:!0};return t.map=new e.google.maps.Map(e.document.getElementById("map-container"),r),t}])}(),function(){angular.module("myApp").factory("Lots",["$q",function(e){var t=function(){};return t.lots=[{_id:"a",name:"Regency Oaks Parking",description:"Regency Oaks Parking",lat:29.629291,lng:-82.371552,spaces:23,buffer:2},{_id:"a1",name:"Regency Oaks Parking1",description:"Regency Oaks Parking1",lat:29.729291,lng:-82.771552,spaces:23,buffer:2},{_id:"a2",name:"Regency Oaks Parking2",description:"Regency Oaks Parking2",lat:29.029291,lng:-82.071552,spaces:23,buffer:2},{_id:"b",name:"24/7 Parking Spaces at Country Gardens by Shands",description:"24/7 Parking Spaces at Country Gardens by Shands",lat:29.633865,lng:-82.342722,spaces:5,buffer:1}],t.get=function(n){var r=e.defer(),a=n._id;if(void 0!==a){var o=t.lots.map(function(e){return e._id}).indexOf(a);-1!==o?r.resolve(t.lots[o]):r.reject()}else r.reject();return r.promise},t}])}(),function(){angular.module("myApp").factory("navigator",["$location",function(e){var t={current:"/"};return t.navigate=function(n){t.current=n,e.path(n)},t}]).run(["navigator","$location","$rootScope",function(e,t,n){"/"!=t.path()&&t.path("/"),n.$on("$locationChangeStart",function(t,n){var r=n.substring(n.search("#")+1);r!=e.current&&t.preventDefault()})}])}(),function(){angular.module("myApp").factory("Reservations",["$filter","$q","Lots",function(e,t,n){var r=function(e){var a=this;a.lot=e.lot,a.start=e.start,a.end=e.end,a.$save=function(){for(var e=t.defer(),o=n.lots[n.lots.map(function(e){return e._id}).indexOf(a.lot)],i=0,s=0;s<r.reservations.length;s++)r.reservations[s].start<a.end&&r.reservations[s].end>a.start&&i++;if(o.spaces-o.buffer-i>0){var l=new Date;a._id="r"+l.getTime(),r.reservations.push({_id:a._id,lot:a.lot,start:a.start,end:a.end}),e.resolve()}else e.reject(409);return e.promise}};return r.reservations=[{_id:"r1",lot:"b",start:14245236e5,end:1424556e6},{_id:"r2",lot:"b",start:14245236e5,end:1424538e6}],r.query=function(n){var a=t.defer(),o=new Date,i=o.getTime();if(n&&n.lot)s=e("filter")(r.reservations,{lot:n.lot},!0);else var s=r.reservations;return n&&"true"===n.active?a.resolve(e("filter")(s,function(e){return e.end>i})):a.resolve(s),a.promise},r}])}(),function(){function e(e){return e*(Math.PI/180)}var t=/^\d+$/,n=/^-*\d+\.?\d*|-*\.\d+/;angular.module("myApp").factory("search",["$q","Lots","Reservations",function(r,a,o){var i={};return i.getDistanceFromLatLonInKm=function(t,n,r,a){var o=6371,i=e(r-t),s=e(a-n),l=Math.sin(i/2)*Math.sin(i/2)+Math.cos(e(t))*Math.cos(e(r))*Math.sin(s/2)*Math.sin(s/2),c=2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l)),u=o*c;return u},i.search=function(e){var s=r.defer(),l=e.lat,c=e.lng,u=e.dia,d=e.start,g=e.end;if(void 0!==l&&void 0!==c&&void 0!==d&&void 0!==g&&n.test(l)&&n.test(c)&&t.test(d)&&t.test(g)&&parseInt(d)<parseInt(g)){for(var f=[],v=0;v<a.lots.length;v++)if(i.getDistanceFromLatLonInKm(l,c,a.lots[v].lat,a.lots[v].lng)<u/2){for(var m=0,p=0;p<o.reservations.length;p++)o.reservations[p].lot===a.lots[v]._id&&o.reservations[p].start<g&&o.reservations[p].end>d&&m++;f.push({_id:a.lots[v]._id,lat:a.lots[v].lat,lng:a.lots[v].lng,available:a.lots[v].spaces-a.lots[v].buffer-m})}s.resolve(f)}else s.reject();return s.promise},i}])}(),function(){angular.module("myApp").directive("confirmationNeeded",function(){return{priority:1,terminal:!0,link:function(e,t,n){var r=n.confirmationNeeded||"Are you sure you want to delete this item?",a=n.ngClick;t.bind("click",function(){window.confirm(r)&&e.$eval(a)})}}})}(),function(){angular.module("myApp").directive("screenHeading",function(){return{restrict:"A",templateUrl:"partials/screenHeading.html",scope:{centerName:"@",leftName:"@",leftIcon:"@",leftFunction:"&",rightName:"@",rightIcon:"@",rightFunction:"&"},bindToController:!0,controllerAs:"screenHeading",controller:function(){}}})}()},{}]},{},[1]);